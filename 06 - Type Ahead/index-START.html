<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Type Ahead ğŸ‘€</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<form class="search-form">
    <input type="text" class="search" placeholder="è¯—å¥ è¯—å è¯—äºº">
    <ul class="suggestions">
        <li>è¾“å…¥è¯å¥ï¼Œæ‰¾ä¸€é¦–è¯—</li>
        <li></li>
    </ul>
</form>
<script>
    // const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
    // åŸæ–‡æ˜¯åŸå¸‚ï¼Œè¿™é‡Œæ”¹ä¸ºå¤è¯—è¯
    const endpoint = 'https://gist.githubusercontent.com/soyaine/81399bb2b24ca1bb5313e1985533c640/raw/bdf7df2cbcf70706c4a5e51a7dfb8c933ed78878/TangPoetry.json';

    const poetrys = [];
    // ä½¿ç”¨fetch()è¯·æ±‚æ•°æ®
    fetch(endpoint).then(blob => blob.json()).then(data => poetrys.push(...data));
    // console.log(poetrys)

    // æ‰¾åˆ°åŒ¹é…çš„è¯—å¥
    function findMatches(wordToMatches, poetrys) {
        // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¯—å¥
        return poetrys.filter(poetry => {
            const regex = new RegExp(wordToMatches, 'gi');
            const author = poetry.detail_author.join('');
            return poetry.detail_text.match(regex) || author.match(regex) || poetry.title.match(regex);
        })
    }

    // å±•ç¤ºåŒ¹é…ç»“æœ
    function displayMatches() {
        // console.log(this.value)
        const matches = findMatches(this.value, poetrys);  // è¿”å›åŒ¹é…ç»“æœ
        // console.log(matches)
        const html = matches.map(poetry => {
            const regex = new RegExp(this.value, 'gi');
            // æ›¿æ¢é«˜äº®æ ‡ç­¾, å³é«˜äº®æœç´¢è¯
            const text = poetry.detail_text.replace(regex, `<span class="hl">${this.value}</span>`);
            const title = poetry.title.replace(regex, `<span class="hl">${this.value}</span>`);
            // æ„é€ HTMLå€¼
            return `<li><span class="poetry">${text}</span><span class="title">${title}</span></li>`;
        }).join('');

        suggestions.innerHTML = html;
    }

    const poetrySearch = document.querySelector('.search');
    const suggestions = document.querySelector('.suggestions');

    // æœç´¢åŒ¹é…äº‹ä»¶
    poetrySearch.addEventListener('change', displayMatches);
    poetrySearch.addEventListener('keyup', displayMatches);  // ä½¿ç”¨keyupå¯ä»¥å®æ—¶åŒ¹é…æ¯ä¸ªå­—ç¬¦

</script>
</body>
</html>
